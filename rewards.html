<!doctype html>
<html lang="en" class="h-full">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>EcoFinds â€“ Rewards</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="assets/css/styles.css" />
	<script>tailwind.config = { darkMode: 'class' };</script>
</head>
<body class="min-h-full bg-emerald-50/40 dark:bg-zinc-950 text-zinc-100">
	<div id="navbar"></div>
	<main class="container py-8">
		<h1 class="text-2xl font-bold">EcoPoints</h1>
		<div class="mt-4 bg-zinc-900 p-4 rounded">
			<div class="text-sm text-zinc-400">Progress to next reward</div>
			<div class="h-3 bg-zinc-800 rounded mt-2 overflow-hidden">
				<div id="progress" class="h-full bg-emerald-600" style="width: 0%"></div>
			</div>
		</div>
		<h2 class="mt-8 text-xl font-semibold">Leaderboard</h2>
		<ol id="leaderboard" class="mt-3 grid gap-2"></ol>
	</main>
	<div id="footer"></div>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="assets/js/supabase.js"></script>
	<script src="assets/js/common.js"></script>
	<script src="assets/js/storage.js"></script>
	<script>
		(async function(){
			const user = (await sb.auth.getUser()).data.user;
			if (user) {
				const { data } = await sb.from('eco_points').select('*').eq('user_id', user.id).single();
				const points = Number(data?.points||0);
				const pct = Math.min(100, (points % 100));
				document.getElementById('progress').style.width = pct + '%';
			}
			const { data: top } = await sb.from('eco_points').select('username, points').order('points',{ascending:false}).limit(5);
			document.getElementById('leaderboard').innerHTML = (top||[]).map((r,i)=>`<li class='p-3 bg-zinc-900 rounded flex items-center justify-between'><span>#${i+1} ${r.username||'User'}</span><span class='font-bold'>${r.points} pts</span></li>`).join('');
		})();
	</script>
</body>
</html>
