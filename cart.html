<!doctype html>
<html lang="en" class="h-full">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>EcoFinds – Cart</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="assets/css/styles.css" />
	<script>tailwind.config = { darkMode: 'class' };</script>
</head>
<body class="min-h-full bg-emerald-50/40 dark:bg-zinc-950 text-zinc-100">
	<div id="navbar"></div>
	<main class="container py-8">
		<h1 class="text-2xl font-bold">Cart</h1>
		<div id="list" class="mt-4 grid gap-3"></div>
		<div class="mt-4 flex items-center justify-between">
			<div id="total" class="text-xl font-bold text-emerald-400">₹0</div>
			<a id="checkout" href="checkout.html" class="px-4 py-2 rounded bg-emerald-600 text-white">Proceed to Checkout</a>
		</div>
		<p id="empty" class="mt-6 text-zinc-400 hidden">Your cart is empty. Consider donating an item to the community! ♻️</p>
	</main>
	<div id="footer"></div>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="assets/js/supabase.js"></script>
	<script src="assets/js/common.js"></script>
	<script src="assets/js/storage.js"></script>
	<script>
		function render(){
			const items = window.eco.cart.get();
			const list = document.getElementById('list');
			if (!items.length) {
				list.innerHTML = '';
				document.getElementById('empty').classList.remove('hidden');
			} else {
				document.getElementById('empty').classList.add('hidden');
				list.innerHTML = items.map(i => `<div class='p-3 rounded bg-zinc-900 flex items-center gap-3'>
					<img src='${i.image||''}' class='w-16 h-16 object-cover rounded'>
					<div class='flex-1'>
						<div class='font-semibold'>${i.title}</div>
						<div class='text-sm text-zinc-400'>${i.category || ''}</div>
						<div class='text-sm text-zinc-400'>Qty: ${i.quantity || 1}</div>
					</div>
					<div class='font-bold'>₹${i.price}</div>
					<button data-remove='${i.id}' class='px-2 py-1 rounded bg-red-700 text-white text-sm'>Remove</button>
				</div>`).join('');
			}
			const total = items.reduce((s,i)=>s+Number(i.price||0)*(i.quantity||1),0);
			document.getElementById('total').textContent = '₹'+total;
		}
		document.addEventListener('click',(e)=>{
			const btn=e.target.closest('[data-remove]');
			if(btn){ window.eco.cart.remove(btn.getAttribute('data-remove')); render(); }
		});
		document.getElementById('checkout').addEventListener('click',()=>{
			const items = window.eco.cart.get();
			if(!items.length) { alert('Cart is empty'); return; }
			// subtotal computed on checkout page; just navigate
		});
		render();
	</script>
</body>
</html>
